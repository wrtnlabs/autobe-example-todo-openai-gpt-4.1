/// Registered application users. Represents individuals with private
/// accounts for the Todo List service. Primary business entity for all
/// authentication, authorization, and account lifecycle operations. Uniquely
/// identified by email for login. Related entities include password reset
/// tokens and active authentication sessions. On deletion, related todo
/// items and session data must be automatically purged for privacy
/// compliance.
///
/// @namespace Actors
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model todo_list_users {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id @db.Uuid
  
  /// User's email address for authentication and communication. Must be unique
  /// across all users, case-insensitive. Used for login and account recovery.
  email String
  
  /// Securely salted hash of the user's password. Never stores the plain
  /// password. Used only for credential verification on login.
  password_hash String
  
  /// Flag indicating whether the user has successfully completed email
  /// ownership verification. Used to enable/disable access prior to
  /// verification.
  is_email_verified Boolean
  
  /// Timestamp for when the user account was created.
  created_at DateTime @db.Timestamptz
  
  /// Timestamp for the latest user account update (profile/email/password
  /// change).
  updated_at DateTime @db.Timestamptz
  
  /// Timestamp for soft deletion (account scheduled for deletion or pending
  /// GDPR removal). Null if active.
  deleted_at DateTime? @db.Timestamptz
  
  //----
  // RELATIONS
  //----
  todo_list_password_reset_tokens todo_list_password_reset_tokens[]
  todo_list_auth_sessions todo_list_auth_sessions[]
  todo_list_todos todo_list_todos[]
  todo_list_deleted_todo_logs todo_list_deleted_todo_logs[]
  
  @@unique([email])
  @@index([created_at])
  @@index([deleted_at])
}

/// Single-use tokens enabling secure password reset for a user account.
/// Tokens are time-limited and bound to the requesting user. Not
/// independently manageable; always created in response to a password reset
/// request and deleted after use or expiry. Supports audit/compliance
/// workflows for account recovery.
///
/// @namespace Actors
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model todo_list_password_reset_tokens {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id @db.Uuid
  
  /// Belonged user's {@link todo_list_users.id}. Associates this reset token
  /// with a user account for verification and recovery purposes.
  todo_list_user_id String @db.Uuid
  
  /// Randomly generated, cryptographically secure token string. Used to verify
  /// password reset intent. Single-use only.
  token String
  
  /// Token expiration timestamp. After this point, the token is invalidated by
  /// the system.
  expires_at DateTime @db.Timestamptz
  
  /// Timestamp when this password reset token was actually used by the user.
  /// Null if not yet used.
  used_at DateTime? @db.Timestamptz
  
  /// Timestamp when this reset token record was created.
  created_at DateTime @db.Timestamptz
  
  //----
  // RELATIONS
  //----
  user todo_list_users @relation(fields: [todo_list_user_id], references: [id], onDelete: Cascade)
  
  @@unique([token])
  @@index([todo_list_user_id])
  @@index([expires_at])
  @@index([used_at])
}

/// Records of authenticated sessions for each user. Enables session token
/// revocation, tracking of active logins for security, automatic expiry, and
/// support for global logout on password or email change. Each session is
/// tied to a user and uniquely identified by session_token. Not directly
/// managed by users.
///
/// @namespace Actors
/// @author AutoBE - https://github.com/wrtnlabs/autobe
model todo_list_auth_sessions {
  //----
  // COLUMNS
  //----
  /// Primary Key.
  id String @id @db.Uuid
  
  /// Belonged user's {@link todo_list_users.id}. Associates session with a
  /// single user for permission enforcement and session history/auditing.
  todo_list_user_id String @db.Uuid
  
  /// Opaque authentication token for this session (e.g., JWT or securely
  /// random string). Used for session validation on each API request.
  session_token String
  
  /// Information about client browser, device, and OS for security logging and
  /// session management.
  user_agent String?
  
  /// Most recent client IP address associated with the session. Used for
  /// security auditing and suspicious activity detection. Optional due to
  /// privacy policy constraints.
  ip_address String?
  
  /// Session expiration timestamp; after this date the session is no longer
  /// valid.
  expires_at DateTime @db.Timestamptz
  
  /// Timestamp for when the session was established.
  created_at DateTime @db.Timestamptz
  
  /// Timestamp when the session was explicitly revoked/logged out. Null if
  /// active.
  revoked_at DateTime? @db.Timestamptz
  
  //----
  // RELATIONS
  //----
  user todo_list_users @relation(fields: [todo_list_user_id], references: [id], onDelete: Cascade)
  
  @@unique([session_token])
  @@index([todo_list_user_id, expires_at])
}